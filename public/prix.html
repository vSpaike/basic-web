<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price of a cookie</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav>
        <ul>
            <li><a href="accueil.html">Acceuil</a></li>
            <li><a href="profil.html">Profil</a></li>
        </ul>
    </nav>
    <form method="POST" action="/objet">
        <label for="nom">Nom de l'objet</label> <br>
        <input type="text" name="name" id="objet">
        <br><br>
        <label for="prix">Prix</label> <br>
        <input type="text" name="price" id="objet">
        <br><br>
        <input type="submit" value="Ajouter">
    </form>

    <h2>Objets disponibles</h2>
    <ul id="objets-list"></ul>

    <script>
        async function supprimerObjet(objet, prix) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')) {
                return; 
            }
            try {
                const response = await fetch('/delete_objet', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ objet, prix })
                });
                console.log(JSON.stringify({ objet, prix }))
                
                if (!response.ok) {
                    throw new Error('Erreur lors de la suppression');
                }
                chargerObjets();
            } catch (err) {
                alert('Erreur : ' + err.message);
                console.error(err);
            }
        }

        async function chargerObjets() {
            try {
                const response = await fetch('/objets');
                if (!response.ok) {
                    throw new Error('Erreur lors du chargement des objets');
                }
                const objets = await response.json();
                const list = document.getElementById('objets-list');
                list.innerHTML = '';
                objets.forEach((obj) => {
                    const li = document.createElement('li');
                    const objet = obj.objet || obj.nom || 'Sans nom';
                    const prix = obj.prix ?? obj.price ?? 'N/A';
                    li.textContent = `${objet} — ${prix}`;
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'Supprimer';
                    deleteBtn.style.marginLeft = '10px';
                    deleteBtn.onclick = () => supprimerObjet(objet, prix);
                    
                    li.appendChild(deleteBtn);
                    list.appendChild(li);
                });
            } catch (err) {
                const list = document.getElementById('objets-list');
                list.innerHTML = '<li>Erreur de chargement.</li>';
                console.error(err);
            }
        }

        window.addEventListener('DOMContentLoaded', chargerObjets);
    </script>
</body>
</html>